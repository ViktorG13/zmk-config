#include <dt-bindings/zmk/matrix_transform.h>
#include "nicenano-layouts.dtsi"

/ {
	kscan: kscan {
		// If the hardware does not use a switch matrix, change this to the
		// appropriate driver and update the properties below to match.
		// See https://zmk.dev/docs/config/kscan for supported key scan drivers.
		compatible = "zmk,kscan-gpio-matrix";
		// Set this to "col2row" or "row2col" to match the hardware. If using
		// "row2col", change the col-gpios to (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)
		// and the row-gpios to GPIO_ACTIVE_HIGH.
		diode-direction = "col2row";
		wakeup-source;
		poll-period-ms = <20>;
		
		// Replace these comments with the GPIO pins in the matrix.
		// See https://zmk.dev/docs/development/hardware-integration/new-shield#shield-overlays
		col-gpios
		= <&pro_micro 2 GPIO_ACTIVE_HIGH>
		, <&pro_micro 7 GPIO_ACTIVE_HIGH>
		;
		
		row-gpios
		= <&pro_micro 3 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
		, <&pro_micro 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
		;
	};
	
	default_transform: default_transform {
		// See https://zmk.dev/docs/development/hardware-integration/new-shield#matrix-transform
		// for how to configure this
		compatible = "zmk,matrix-transform";
		columns = <2>;
		rows = <2>;
		
		map = <
		RC(0, 0) RC(0, 1)
		RC(1, 0) RC(1, 1)
		>;
	};
	
	physical_layout: physical_layout {
		compatible = "zmk,physical-layout"
		display-name = "Default layout";
		transform = <&default_transform>;
		kscan = <&default_kscan>;

        keys //                 w   h    x   y rot  rx ry
        = <&key_physical_attrs 100 100   0   0  0    0  0> // Row 1
        , <&key_physical_attrs 100 100  100  0  0    0  0> // Row 2
        // , <&key_physical_attrs 100 100   0  100 0    0  0>
        // , <&key_physical_attrs 100 100  100 100 0    0  0>
        ;
	}
};
